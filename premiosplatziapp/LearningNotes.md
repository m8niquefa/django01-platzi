# Django Project

A project in django is a set of apps in django

This project will have several apps:

## Polls

Small apps to be reusable

# Commands
* ```python manage.py runserver```
* ```python manage.py startapp polls```
* ```python manage.py makemigrations polls``` Create the migrations from the Python classes
* ```python manage.py migrate``` 
* ```python manage.py shell``` Terminal with access to the project.

## Clear Django shell

As you will do in normal python shell

```import os```
```os.system("clear")```

## Inside the Django Shell
* ```>>> Question.objects.all()```

## Saving:
Just use save method ```>>> object_instance.save()```. Example:

## Query by id
Just use something like ```Question.objects.get(pk=1)```. It retrieves from the ```Question``` table the row with primary key ```1```. If it does not exists, it raises an exception self.model.DoesNotExist.

## Double underscore django magic

You can access internal attributes with double underscore, like accessing the year of a date:

* ```Question.objects.get(pub_date__year=timezone.now().year)```

It can also be used for a lot of things. Further reading:

* https://docs.djangoproject.com/en/4.1/topics/db/queries/

## Some ChatGPT4 Answer to For what is useful the double underscore in Django?:
In Django, the double underscore (__) is useful for making complex queries using the ORM (Object-Relational Mapping) system. Specifically, it is used for traversing relationships and making lookups in related models. When you use a double underscore, you can access the fields of related models or apply various filters on the related fields.

Here are some common use cases for the double underscore in Django:

Accessing related model fields: If you have two related models, such as Author and Book, where an author has multiple books, you can access the author's book fields like this:

```Author.objects.filter(book__title="The Catcher in the Rye")```

Chaining lookups: You can chain multiple lookups using double underscores. For example, if there is another related model Publisher with a foreign key to Book, you can filter the authors based on the publisher's name like this:

```Author.objects.filter(book__publisher__name="Penguin Books")```

Lookup types: Double underscores can also be used with various lookup types, like exact, iexact, contains, icontains, startswith, istartswith, endswith, iendswith, range, year, month, day, week_day, isnull, regex, and iregex. For example, to filter books with a title that contains a specific word, you can do:


```Book.objects.filter(title__icontains='Django')```
Reverse lookups: You can use double underscores for reverse lookups as well. For instance, to find all books written by authors with a specific last name, you can use:

```Book.objects.filter(author__last_name='Smith')```

These are just a few examples of how the double underscore is useful in Django for creating complex queries and traversing relationships between models.


### Can double underscore used to access composed fields like timezone fields? 

Yes, you can use the double underscore to access the components of timezone-aware DateTime fields in Django. This is particularly helpful when you need to filter data based on specific parts of the DateTime field, such as year, month, or day.

For example, suppose you have a Blog model with a timezone-aware created_at DateTime field:
```
from django.db import models
from django.utils import timezone

class Blog(models.Model):
    title = models.CharField(max_length=200)
    content = models.TextField()
    created_at = models.DateTimeField(default=timezone.now)
```
You can use the double underscore to access and filter the data based on components of the created_at field. Here are a few examples:

Filter blogs created in a specific year:
```Blog.objects.filter(created_at__year=2023)```

Filter blogs created in a specific month:

```Blog.objects.filter(created_at__month=3)```

Filter blogs created on a specific day:

```Blog.objects.filter(created_at__day=30)```

Filter blogs created on a specific day of the week (e.g., Sunday):

```Blog.objects.filter(created_at__week_day=1)```

You can also chain these lookups together or combine them with other lookups to create more complex queries. Keep in mind that these queries will take the timezone into consideration when filtering the data, ensuring accurate results based on the DateTime field's timezone information.


# _set

We cen access the set of **rows** related to a row via autogenerated foreign keys.

For the example it will look like this:

```
>>> q = Question.objects.get(pk=1)
>>> q
<Question: Best course is? 2023-03-31 03:22:22.945491+00:00>
>>> q.choice_set.all()
<QuerySet []>
>>> q.choice_set.create(choice_text="Curso Basico Python", votes=0)
<Choice: Curso Basico Python>
>>> q.choice_set.all()
<QuerySet [<Choice: Curso Basico Python>]>
>>> q.choice_set.create(choice_text="Curso Elixir", votes=0)
<Choice: Curso Elixir>
>>> q.choice_set.create(choice_text="Curso Java", votes=0)
<Choice: Curso Java>
>>> q.choice_set.all()
<QuerySet [<Choice: Curso Basico Python>, <Choice: Curso Elixir>, <Choice: Curso Java>]>
>>> q.choice_set.count()
3
>>> Choice.objects.filter(question__pub_date__year=timezone.now().year)
<QuerySet [<Choice: Curso Basico Python>, <Choice: Curso Elixir>, <Choice: Curso Java>]>
>>> 
```

# Data admin

Not in flask or others. Feature unique from Django framework.

Is basically an UI to modify data.

Make sure to register the admin page in ```admin.py``` of the polls app.
```admin.site.register(Question)```

First we need to create a super user:

```python manage.py createsuperuser```

Then log in:

```http://localhost:8000/admin```


# Views

There are two ways to create views in django. Function based and classes based. 

Simple heuristic advice to choose between the two: If you can use Classes based views, used.

## Functions Based Views

## Classes Based Views: Generic Views

Works better to meet the DRY principle (don't repeat yourself).

There are several examples of Generic Views like:

* ListView
* LoginVies
* LogoutView
* CreateView
* UpdateView

Further reading: https://ccbv.co.uk 